// Prisma schema for your Ertib Delivery backend

generator client {
  provider = "prisma-client-js"
}

// prisma/schema.prisma
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  // directUrl = env("DATABASE_URL_UNPOOLED") // For Neon pooling
}

//
// ======================
// User Model
// ======================
model User {
  id        Int      @id @default(autoincrement())
  name      String
  phone     String   @unique
  block     String
  password  String
  role      String   @default("user")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders    Order[]  // Relation to orders
}

//
// ======================
// Order Model
// ======================
model Order {
  id           Int      @id @default(autoincrement())
  customerName String
  phone        String
  location     String
  source       String   @default("online")
  total        Float
  trackingCode String   @unique
  trackUrl     String
  status       String   @default("pending") // pending | in_progress | arrived | delivered | canceled | no_show
  statusHistory Json     @default("[]")     // [{status: "pending", at: "2025-11-21T..."}, ...]
  smsHistory   Json     @default("[]")
  items        Json

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  userId       Int?
  user         User?    @relation(fields: [userId], references: [id])
  notes        String?
}
